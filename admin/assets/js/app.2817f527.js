(function(e){function t(t){for(var a,i,c=t[0],s=t[1],u=t[2],g=0,d=[];g<c.length;g++)i=c[g],Object.prototype.hasOwnProperty.call(o,i)&&o[i]&&d.push(o[i][0]),o[i]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);l&&l(t);while(d.length)d.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],a=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(a=!1)}a&&(r.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},o={app:0},r=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/admin/assets/";var c=window["webpackJsonp"]=window["webpackJsonp"]||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var u=0;u<c.length;u++)t(c[u]);var l=s;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0374":function(e,t,n){},"36e0":function(e,t,n){"use strict";n("0374")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("7a23"),o={class:"app"},r={class:"panel"};function i(e,t,n,i,c,s){var u=Object(a["n"])("auth"),l=Object(a["n"])("top-bar"),g=Object(a["n"])("list-pages"),d=Object(a["n"])("current-page");return Object(a["i"])(),Object(a["e"])(a["a"],null,[Object(a["g"])(u),Object(a["f"])("div",o,[Object(a["f"])("div",r,[Object(a["g"])(l),Object(a["g"])(g,{onSetPage:s.setPage},null,8,["onSetPage"])]),Object(a["g"])(d,{page:c.current_page,class:"iframe"},null,8,["page"])])],64)}var c={class:"container-fluid border",style:{"z-index":"99999"}},s={key:0,class:"rename-page"},u={class:"row"},l={class:"col-md-4"},g={class:"buttons"},d=["disabled"],f={class:"row"},p={class:"col-md-12"},m={class:"pages"},b=["onClick"],P={class:"badge bg-primary"},h=["onClick"],O=["onClick"],j=["onClick"];function v(e,t,n,o,r,i){var v=Object(a["n"])("loading");return Object(a["i"])(),Object(a["e"])("div",c,[r.isShowForm?(Object(a["i"])(),Object(a["e"])("div",s,[Object(a["f"])("div",u,[Object(a["f"])("div",l,[Object(a["f"])("form",{class:"border bg-white p-3",onSubmit:t[3]||(t[3]=Object(a["t"])((function(){return i.renamePageServer&&i.renamePageServer.apply(i,arguments)}),["prevent"]))},[Object(a["s"])(Object(a["f"])("input",{class:"form-control form-control-sm mb-3",type:"text","onUpdate:modelValue":t[0]||(t[0]=function(e){return r.old_page=e}),placeholder:"Старое имя","aria-label":".form-control-sm example"},null,512),[[a["p"],r.old_page]]),Object(a["s"])(Object(a["f"])("input",{class:"form-control form-control-sm mb-3",type:"text","onUpdate:modelValue":t[1]||(t[1]=function(e){return r.new_page=e}),placeholder:"Новое имя","aria-label":".form-control-sm example"},null,512),[[a["p"],r.new_page]]),Object(a["f"])("div",g,[Object(a["f"])("button",{type:"submit",class:"btn btn-primary mb-3",disabled:e.isLoading},"Переименовать",8,d),Object(a["f"])("button",{type:"submit",class:"btn btn-warning mb-3",onClick:t[2]||(t[2]=function(e){r.isShowForm=!1,r.old_page=""})},"Отмена")])],32)])])])):Object(a["d"])("",!0),Object(a["f"])("div",f,[Object(a["f"])("div",p,[e.isLoading?(Object(a["i"])(),Object(a["c"])(v,{key:0})):Object(a["d"])("",!0),Object(a["f"])("ul",m,[e.list_pages?(Object(a["i"])(!0),Object(a["e"])(a["a"],{key:0},Object(a["m"])(e.list_pages.files,(function(t){return Object(a["i"])(),Object(a["e"])("li",{class:"page",key:t,onClick:function(n){return e.$emit("setPage",t)}},[Object(a["f"])("span",P,Object(a["o"])(t),1),Object(a["f"])("ul",null,[Object(a["f"])("li",null,[Object(a["f"])("span",{class:"badge bg-danger",onClick:function(e){return i.deletePage(t)}},"Удалить",8,h)]),Object(a["f"])("li",null,[Object(a["f"])("span",{class:"badge bg-info",onClick:function(e){return i.copyPage(t)}},"Копировать",8,O)]),Object(a["f"])("li",null,[Object(a["f"])("span",{class:"badge bg-warning",onClick:function(e){return i.renamePageForm(t)}},"Переименовать",8,j)])])],8,b)})),128)):Object(a["d"])("",!0)])])])])}var S,L,y,_=n("5530"),w=n("ade3"),C=(n("d3b7"),n("bc3a")),F=n.n(C),k=function(e){try{var t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(n){return console.log("Error getting data from localStorage",n),null}},x=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch(n){console.log("Error saving data in localStorage",n)}},T=function(e,t){return R.post("/admin/api/login",{_method:"POST",login:e,password:t})},A={login:T},I={data:null,isLoading:!1,error:null,auth:!1},E={loginStart:"[Login] Login Start",loginSuccess:"[Login] Login Success",loginFailure:"[Login] Login Failure"},$={login:"[Login] Login",setAuth:"[Login] Set Auth",setLogout:"[Login] Set Logout"},M=(S={},Object(w["a"])(S,E.loginStart,(function(e){e.data=null,e.isLoading=!0})),Object(w["a"])(S,E.loginSuccess,(function(e,t){e.isLoading=!1,e.data=t})),Object(w["a"])(S,E.loginFailure,(function(e){e.isLoading=!1,e.data=null})),S),V=(L={},Object(w["a"])(L,$.login,(function(e,t){return new Promise((function(n){e.commit(E.loginStart),A.login(t.login,t.password).then((function(t){e.commit(E.loginSuccess,t.data),n(t.data)})).catch((function(t){e.commit(E.loginFailure,t)}))}))})),Object(w["a"])(L,$.setAuth,(function(e,t){e.state.auth=!0,e.state.data=t,x("token",t)})),Object(w["a"])(L,$.setLogout,(function(e){e.state.auth=!1,e.state.data=null})),L),D={state:I,actions:V,mutations:M};window.admin_config||k("config")||F.a.post("/admin/api/config.json").then((function(e){x("config",e.data.data)})).catch((function(e){console.log("Ошибка загрузки конфигурации. Обновите страницу [CTRL+F5]",e)}));var z=k("config");y=z?z["base_url"]:"/",F.a.defaults.baseURL=y;var U=k("token");F.a.defaults.headers.common["Authorization"]="Bearer ".concat(U),F.a.defaults.headers.common["Accept"]="application/json";var q,N,R=F.a,B=function(){return R.post("/admin/api/get_list_pages",{_method:"POST"}).then((function(e){return e.data}))},J=function(e){return R.post("/admin/api/delete_page",{_method:"POST",page:e}).then((function(e){return e.data}))},H=function(e){return R.post("/admin/api/copy_page",{_method:"POST",page:e}).then((function(e){return e.data}))},X=function(e,t){return R.post("/admin/api/rename_page",{_method:"POST",old_page:e,new_page:t}).then((function(e){return e.data}))},W={getAllPages:B,deletePage:J,copyPage:H,renamePage:X},G={data:null,isLoading:!1,error:null},K={getListPagesStart:"[ListPages] ListPages Start",getListPagesSuccess:"[ListPages] ListPages Success",getListPagesFailure:"[ListPages] ListPages Failure",deletePageStart:"[ListPages] Delete Page Start",deletePageSuccess:"[ListPages] Delete Page Success",deletePageFailure:"[ListPages] Delete Page Failure",copyPageStart:"[ListPages] Copy Page Start",copyPageSuccess:"[ListPages] Copy Page Success",copyPageFailure:"[ListPages] Copy Page Failure",renamePageStart:"[ListPages] Rename Page Start",renamePageSuccess:"[ListPages] Rename Page Success",renamePageFailure:"[ListPages] Rename Page Failure"},Q={getListPages:"[ListPages] List Pages",deletePage:"[ListPages] Delete Page",copyPage:"[ListPages] Copy Page",renamePage:"[ListPages] Rename Page"},Y=(q={},Object(w["a"])(q,K.getListPagesStart,(function(e){e.data=null,e.isLoading=!0,e.error=null})),Object(w["a"])(q,K.getListPagesSuccess,(function(e,t){e.isLoading=!1,e.data=t})),Object(w["a"])(q,K.getCurrentPageFailure,(function(e,t){e.isLoading=!1,e.error=t})),Object(w["a"])(q,K.deletePageStart,(function(e){e.isLoading=!0,e.error=null})),Object(w["a"])(q,K.deletePageSuccess,(function(e){e.isLoading=!1})),Object(w["a"])(q,K.deletePageFailure,(function(e,t){e.isLoading=!1,e.error=t})),Object(w["a"])(q,K.copyPageStart,(function(e){e.isLoading=!0,e.error=null})),Object(w["a"])(q,K.copyPageSuccess,(function(e){e.isLoading=!1})),Object(w["a"])(q,K.copyPageFailure,(function(e,t){e.isLoading=!1,e.error=t})),Object(w["a"])(q,K.renamePageStart,(function(e){e.isLoading=!0,e.error=null})),Object(w["a"])(q,K.renamePageSuccess,(function(e){e.isLoading=!1})),Object(w["a"])(q,K.renamePageFailure,(function(e,t){e.isLoading=!1,e.error=t})),q),Z=(N={},Object(w["a"])(N,Q.getListPages,(function(e,t){return new Promise((function(t){e.commit(K.getListPagesStart),W.getAllPages().then((function(n){!1===n.data.auth&&(e.rootState.login.auth=!1,e.rootState.login.data=null),e.commit(K.getListPagesSuccess,n.data),t(n.data)})).catch((function(t){e.commit(K.getListPagesFailure,t)}))}))})),Object(w["a"])(N,Q.deletePage,(function(e,t){return new Promise((function(n){e.commit(K.deletePageStart),W.deletePage(t).then((function(t){e.commit(K.deletePageSuccess,t.data),n(t.data)})).catch((function(t){e.commit(K.deletePageFailure,t)}))}))})),Object(w["a"])(N,Q.copyPage,(function(e,t){return new Promise((function(n){e.commit(K.copyPageStart),W.copyPage(t).then((function(t){e.commit(K.copyPageSuccess),n(t.data)})).catch((function(t){e.commit(K.copyPageFailure,t)}))}))})),Object(w["a"])(N,Q.renamePage,(function(e,t){return new Promise((function(n){e.commit(K.renamePageStart),console.log(t),W.renamePage(t.old_page,t.new_page).then((function(t){e.commit(K.renamePageSuccess),n(t.data)})).catch((function(t){e.commit(K.renamePageFailure,t)}))}))})),N),ee={state:G,actions:Z,mutations:Y},te=n("5502");function ne(e,t,n,o,r,i){return Object(a["i"])(),Object(a["e"])("h1",null,"Loading...")}var ae={name:"Loading"};ae.render=ne;var oe=ae,re={name:"ListPages",components:{Loading:oe},data:function(){return{isShowForm:!1,old_page:null,new_page:null}},methods:{getPages:function(){this.$store.dispatch(Q.getListPages).then((function(e){console.log("List pages",e)}))},deletePage:function(e){this.$store.dispatch(Q.deletePage,e),this.getPages()},copyPage:function(e){this.$store.dispatch(Q.copyPage,e),this.getPages()},renamePageForm:function(e){this.isShowForm=!0,this.old_page=e},renamePageServer:function(){this.isShowForm=!1,this.$store.dispatch(Q.renamePage,{old_page:this.old_page,new_page:this.new_page}),this.getPages()}},mounted:function(){this.getPages()},computed:Object(_["a"])({},Object(te["b"])({list_pages:function(e){return e.list_pages.data},isLoading:function(e){return e.list_pages.isLoading}}))};n("c82c");re.render=v;var ie=re,ce={ref:"iframe",style:{"z-index":"100"}};function se(e,t,n,o,r,i){return Object(a["i"])(),Object(a["e"])("iframe",ce,null,512)}n("159b"),n("ac1f"),n("5319");var ue,le,ge=function(e){return R.post("/admin/api/get_single_page",{_method:"POST",page:e})},de=function(e,t){return R.post("/admin/api/save_single_page",{_method:"POST",page:e,data:t})},fe={getPage:ge,savePage:de};function pe(e){var t=new XMLSerializer;return t.serializeToString(e)}var me={data:null,name_page:null,virtual_page:null,isLoading:!1,error:null},be={getCurrentPageStart:"[CurrentPage] Current Page Start",getCurrentPageSuccess:"[CurrentPage] Current Page Success",getCurrentPageFailure:"[CurrentPage] Current Page Failure",setVirtualPage:"[CurrentPage] Set Virtual Page (local action)"},Pe={getCurrentPage:"[CurrentPage] Current Page",setVirtualPage:"[CurrentPage] Set VirtualPage",savePage:"[CurrentPage] Save Page"},he=(ue={},Object(w["a"])(ue,be.getCurrentPageStart,(function(e,t){e.data=null,e.isLoading=!0,e.name_page=t})),Object(w["a"])(ue,be.getCurrentPageSuccess,(function(e,t){e.isLoading=!1,e.data=t})),Object(w["a"])(ue,be.getCurrentPageFailure,(function(e){e.isLoading=!1,e.name_page=null})),Object(w["a"])(ue,be.setVirtualPage,(function(e,t){e.virtual_page=t})),ue),Oe=(le={},Object(w["a"])(le,Pe.getCurrentPage,(function(e,t,n,a){return new Promise((function(n){e.commit(be.getCurrentPageStart,t),fe.getPage(t).then((function(t){!1===t.data.auth&&(e.rootState.login.auth=!1,e.rootState.login.data=null),e.commit(be.getCurrentPageSuccess,t.data),n(t.data)})).catch((function(t){e.commit(be.getCurrentPageFailure)}))}))})),Object(w["a"])(le,Pe.setVirtualPage,(function(e,t){return new Promise((function(n){e.commit(be.setVirtualPage,t),n()}))})),Object(w["a"])(le,Pe.savePage,(function(e){return new Promise((function(t){var n=e.state.virtual_page,a=n.querySelectorAll("[nodeid]");a.forEach((function(e){e.removeAttribute("nodeid"),e.removeAttribute("contenteditable")})),fe.savePage(e.state.name_page,pe(n)).then((function(e){t()})).catch((function(e){console.log(e)}))}))})),le),je={state:me,actions:Oe,mutations:he},ve={name:"CurrentPage",props:{page:{type:String,required:!0,validator:function(e){return e.length>0}}},data:function(){return{iframe:null}},mounted:function(){this.setPage()},methods:{setPage:function(){var e=this;this.$store.dispatch(Pe.getCurrentPage,this.page).then((function(t){var n=e.optimization_for_editing(t.data.page),a=n.createElement("style");a.innerHTML="\n          [nodeid]:hover{\n            outline: 3px solid orange !important;\n            outline-offset: 8px !important;\n          }\n          [nodeid]:focus{\n            outline: 3px solid red !important;\n            outline-offset: 8px !important;\n          }",n.head.appendChild(a),e.$store.dispatch(Pe.setVirtualPage,n),e.iframe=e.$refs.iframe.load(e.serializeDomToStr(n)),e.iframe.then((function(t){var n=t.contentWindow.document.body;function a(e){var t=e.target,n=t.getAttribute("nodeid"),a=this.virtual_page.querySelector("body"),o=a.querySelector('[nodeid="'.concat(n,'"]'));o.innerText=t.innerText}for(var o=n.querySelectorAll("[nodeid]"),r=0;r<o.length;r++)o[r].addEventListener("keypress",(function(e){13===e.keyCode&&e.target.blur()})),o[r].addEventListener("blur",a.bind(e)),"A"!==o[r].tagName&&"BUTTON"!==o[r].tagName||o[r].addEventListener("contextmenu",(function(e){e.preventDefault(),e.target.focus()}))}))})).catch((function(e){console.log("Current page:",e)}))},optimization_for_editing:function(e){var t=new DOMParser,n=t.parseFromString(e,"text/html"),a=[];function o(e){e.childNodes.forEach((function(e){3===e.nodeType&&e.nodeValue.replace(/\s+/g,"").length>0?a.push(e):o(e)}))}return o(n.body),a.forEach((function(e,t){e.parentElement.contentEditable="true",e.parentElement.setAttribute("nodeid",t)})),n},serializeDomToStr:function(e){var t=new XMLSerializer;return t.serializeToString(e)}},watch:{page:function(){this.setPage()}},computed:Object(_["a"])({},Object(te["b"])({virtual_page:function(e){return e.current_page.virtual_page}}))};ve.render=se;var Se=ve;function Le(e,t,n,o,r,i){return Object(a["i"])(),Object(a["e"])("div",{contenteditable:"true",onInput:t[0]||(t[0]=function(t){return e.$emit("update:content",t.target.innerText)})},null,32)}var ye={name:"Editable",props:["content"],mounted:function(){this.$el.innerText=this.content},watch:{content:function(){this.$el.innerText=this.content}}};ye.render=Le;var _e=ye;Object(a["k"])("data-v-37f390ec");var we={class:"top-bar"};function Ce(e,t,n,o,r,i){return Object(a["i"])(),Object(a["e"])("div",we,[Object(a["f"])("button",{type:"button",class:"btn btn-success mx-3",onClick:t[0]||(t[0]=function(){return i.savePage&&i.savePage.apply(i,arguments)})},"Сохранить")])}Object(a["j"])();var Fe={name:"TopBar",methods:{savePage:function(){this.$store.dispatch(Pe.savePage)}},computed:Object(_["a"])({},Object(te["b"])({virtual_page:function(e){return e.current_page.virtual_page}}))};n("924d");Fe.render=Ce,Fe.__scopeId="data-v-37f390ec";var ke=Fe;Object(a["k"])("data-v-5aa22b9e");var xe={class:"modal"},Te={class:"modal-dialog"},Ae={class:"modal-content"},Ie={class:"modal-header"},Ee=Object(a["f"])("h5",{class:"modal-title"},"Авторизация",-1),$e={class:"modal-body"},Me={class:"mb-3"},Ve=Object(a["f"])("label",{for:"exampleFormControlInput1",class:"form-label"},"Логин",-1),De={class:"mb-3"},ze=Object(a["f"])("label",{for:"exampleFormControlInput2",class:"form-label"},"Пароль",-1),Ue={class:"modal-footer"};function qe(e,t,n,o,r,i){return Object(a["s"])((Object(a["i"])(),Object(a["e"])("div",xe,[Object(a["f"])("div",Te,[Object(a["f"])("div",Ae,[Object(a["f"])("div",Ie,[Ee,Object(a["f"])("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:t[0]||(t[0]=function(){return i.closeModal&&i.closeModal.apply(i,arguments)})})]),Object(a["f"])("div",$e,[Object(a["f"])("div",Me,[Ve,Object(a["s"])(Object(a["f"])("input",{type:"text",class:"form-control",id:"exampleFormControlInput1","onUpdate:modelValue":t[1]||(t[1]=function(e){return r.user.login=e})},null,512),[[a["p"],r.user.login]])]),Object(a["f"])("div",De,[ze,Object(a["s"])(Object(a["f"])("input",{type:"text",class:"form-control",id:"exampleFormControlInput2","onUpdate:modelValue":t[2]||(t[2]=function(e){return r.user.password=e})},null,512),[[a["p"],r.user.password]])])]),Object(a["f"])("div",Ue,[Object(a["f"])("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[3]||(t[3]=function(){return i.closeModal&&i.closeModal.apply(i,arguments)})},"Отмена"),Object(a["f"])("button",{type:"button",class:"btn btn-primary",onClick:t[4]||(t[4]=Object(a["t"])((function(){return i.authUser&&i.authUser.apply(i,arguments)}),["prevent"]))},"Войти")])])])],512)),[[a["q"],!e.auth]])}Object(a["j"])();var Ne={name:"Auth",data:function(){return{user:{login:null,password:null}}},methods:{closeModal:function(){},authUser:function(){var e=this;this.$store.dispatch($.login,this.user).then((function(t){x("token",t["token"]),e.$store.dispatch($.setAuth,k("token")),window.location.reload()}))}},computed:Object(_["a"])({},Object(te["b"])({auth:function(e){return e.login.auth}}))};n("8263");Ne.render=qe,Ne.__scopeId="data-v-5aa22b9e";var Re=Ne,Be={name:"App",components:{Auth:Re,TopBar:ke,Editable:_e,CurrentPage:Se,ListPages:ie},data:function(){return{current_page:"index.html"}},methods:{setPage:function(e){this.current_page=e},checkAuth:function(){var e=k("token");Boolean(e)?this.$store.dispatch($.setAuth,e):this.$store.dispatch($.setLogout)}},mounted:function(){this.checkAuth()}};n("36e0");Be.render=i;var Je=Be,He=Object(te["a"])({state:{},mutations:{},actions:{},modules:{current_page:je,list_pages:ee,login:D}});n("ab8b");n("d53f");var Xe=Object(a["b"])(Je);Xe.use(He).mount("#app")},"7e3d":function(e,t,n){},8263:function(e,t,n){"use strict";n("dda4")},"924d":function(e,t,n){"use strict";n("7e3d")},c82c:function(e,t,n){"use strict";n("d262")},d262:function(e,t,n){},d53f:function(e,t,n){n("d3b7"),n("25f0"),HTMLIFrameElement.prototype.load=function(e,t){var n=this;try{n.srcdoc=e+"?rnd="+Math.random().toString().substring(2)}catch(c){if(!t)return new Promise((function(e,t){t(c)}));t(c)}var a=6e4,o=200,r=0;if(!t)return new Promise((function(e,t){var i=setInterval((function(){if(!n)return clearInterval(i);r++,n.contentDocument&&"complete"===n.contentDocument.readyState?(clearInterval(i),e(n)):r*o>a&&t(new Error("Iframe load fail!"))}),o)}));var i=setInterval((function(){if(!n)return clearInterval(i);n.contentDocument&&"complete"===n.contentDocument.readyState?(clearInterval(i),t(n)):r*o>a&&t(new Error("Iframe load fail!"))}),o)}},dda4:function(e,t,n){}});